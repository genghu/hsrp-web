<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSRP - Human Subject Recruitment Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1><i class="fas fa-brain me-2"></i>HSRP</h1>
                </div>
                <div id="nav-menu" class="nav-menu">
                    <a href="#" onclick="showPage('home'); return false;"><i class="fas fa-home me-1"></i>Home</a>
                    <a href="#" id="nav-login" onclick="showPage('login'); return false;"><i class="fas fa-sign-in-alt me-1"></i>Login</a>
                    <a href="#" id="nav-register" onclick="showPage('register'); return false;"><i class="fas fa-user-plus me-1"></i>Register</a>
                    <a href="#" id="nav-dashboard" style="display:none;" onclick="showDashboard(); return false;"><i class="fas fa-tachometer-alt me-1"></i>Dashboard</a>
                    <a href="#" id="nav-logout" style="display:none;" onclick="logout()"><i class="fas fa-sign-out-alt me-1"></i>Logout</a>
                </div>
                <div class="language-switcher" id="language-switcher">
                    <div class="language-dropdown" id="languageDropdown">
                        <i class="fas fa-globe"></i>
                        <span id="currentLang">中文</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="language-menu" id="languageMenu">
                        <div class="language-option" data-lang="en">
                            <i class="fas fa-flag-usa"></i>
                            <span>English</span>
                        </div>
                        <div class="language-option active" data-lang="zh">
                            <i class="fas fa-flag"></i>
                            <span>中文</span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="container">
            <!-- Home Page -->
            <div id="page-home" class="page active">
                <div class="hero">
                    <h1 data-i18n="welcome_title">Welcome to HSRP</h1>
                    <p class="subtitle" data-i18n="welcome_subtitle">Human Subject Recruitment Platform</p>
                    <p data-i18n="welcome_description">Connect researchers with participants for scientific studies</p>
                    <div class="hero-buttons">
                        <button class="glass-button" onclick="showPage('register')" data-i18n="get_started"><i class="fas fa-rocket me-2"></i>Get Started</button>
                        <button class="glass-button" onclick="showPage('login')" data-i18n="sign_in"><i class="fas fa-sign-in-alt me-2"></i>Sign In</button>
                    </div>
                </div>

                <div class="features">
                    <div class="feature">
                        <h3 data-i18n="for_researchers"><i class="fas fa-microscope me-2"></i>For Researchers</h3>
                        <p data-i18n="researchers_desc">Create experiments, manage sessions, and recruit participants efficiently</p>
                    </div>
                    <div class="feature">
                        <h3 data-i18n="for_participants"><i class="fas fa-users me-2"></i>For Participants</h3>
                        <p data-i18n="participants_desc">Browse available studies, sign up for sessions, and contribute to science</p>
                    </div>
                    <div class="feature">
                        <h3 data-i18n="secure_reliable"><i class="fas fa-shield-alt me-2"></i>Secure & Reliable</h3>
                        <p data-i18n="security_desc">Your data is protected with enterprise-grade security</p>
                    </div>
                </div>
            </div>

            <!-- Login Page -->
            <div id="page-login" class="page">
                <div class="auth-container">
                    <h2 data-i18n="login_title">Login</h2>
                    <form id="login-form" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="login-email" data-i18n="email">Email</label>
                            <input type="email" id="login-email" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password" data-i18n="password">Password</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <div id="login-error" class="error-message"></div>
                        <button type="submit" class="glass-button" style="width:100%;" data-i18n="login"><i class="fas fa-sign-in-alt me-2"></i>Login</button>
                    </form>
                    <p class="auth-link"><span data-i18n="no_account">Don't have an account?</span> <a href="#" onclick="showPage('register')" data-i18n="register">Register</a></p>
                </div>
            </div>

            <!-- Register Page -->
            <div id="page-register" class="page">
                <div class="auth-container">
                    <h2 data-i18n="register_title">Register</h2>

                    <!-- Registration Method Tabs -->
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="email" onclick="switchRegisterTab('email')">
                            <i class="fas fa-envelope me-2"></i><span data-i18n="email_register">Email</span>
                        </button>
                        <button class="auth-tab" data-tab="wechat" onclick="switchRegisterTab('wechat')">
                            <i class="fab fa-weixin me-2"></i><span data-i18n="wechat_register">WeChat</span>
                        </button>
                        <button class="auth-tab" data-tab="qq" onclick="switchRegisterTab('qq')">
                            <i class="fab fa-qq me-2"></i><span data-i18n="qq_register">QQ</span>
                        </button>
                    </div>

                    <!-- Email Registration Form -->
                    <div id="register-email-content" class="auth-tab-content active">
                        <form id="register-form" onsubmit="handleRegister(event)">
                            <!-- Chinese: Combined name field -->
                            <div class="form-group" id="name-field-zh" style="display:none;">
                                <label for="register-fullName" data-i18n="full_name">姓名</label>
                                <input type="text" id="register-fullName">
                            </div>

                            <!-- English: Separate first/last name fields -->
                            <div id="name-fields-en">
                                <div class="form-group">
                                    <label for="register-firstName" data-i18n="first_name">First Name</label>
                                    <input type="text" id="register-firstName">
                                </div>
                                <div class="form-group">
                                    <label for="register-lastName" data-i18n="last_name">Last Name</label>
                                    <input type="text" id="register-lastName">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="register-email" data-i18n="email">Email</label>
                                <input type="email" id="register-email" required>
                            </div>
                            <div class="form-group">
                                <label for="register-password" data-i18n="password">Password</label>
                                <input type="password" id="register-password" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label for="register-role" data-i18n="i_am_a">I am a:</label>
                                <select id="register-role" required onchange="updateResearcherFields()">
                                    <option value="subject" data-i18n="participant">Participant (Subject)</option>
                                    <option value="researcher" data-i18n="researcher">Researcher</option>
                                </select>
                            </div>
                            <div id="researcher-fields" style="display:none;">
                                <div class="form-group">
                                    <label for="register-institution" data-i18n="institution">Institution</label>
                                    <input type="text" id="register-institution">
                                </div>
                                <div class="form-group">
                                    <label for="register-department" data-i18n="department">Department</label>
                                    <input type="text" id="register-department">
                                </div>
                            </div>
                            <div id="register-error" class="error-message"></div>
                            <button type="submit" class="glass-button" style="width:100%;" data-i18n="register"><i class="fas fa-user-plus me-2"></i>Register</button>
                        </form>
                    </div>

                    <!-- WeChat QR Code Registration -->
                    <div id="register-wechat-content" class="auth-tab-content">
                        <div class="qr-container">
                            <div class="qr-header">
                                <i class="fab fa-weixin" style="font-size: 2rem; color: #07C160;"></i>
                                <h3 data-i18n="scan_wechat_qr">Scan with WeChat</h3>
                                <p data-i18n="wechat_qr_desc">Open WeChat and scan the QR code to register</p>
                            </div>
                            <div class="qr-code-wrapper">
                                <div id="wechat-qr-code" class="qr-code">
                                    <div class="qr-loading">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p data-i18n="loading_qr">Loading QR Code...</p>
                                    </div>
                                </div>
                                <div id="wechat-qr-status" class="qr-status"></div>
                            </div>
                            <button class="glass-button" style="width:100%; margin-top: 1rem;" onclick="refreshWeChatQR()">
                                <i class="fas fa-sync-alt me-2"></i><span data-i18n="refresh_qr">Refresh QR Code</span>
                            </button>
                        </div>
                    </div>

                    <!-- QQ QR Code Registration -->
                    <div id="register-qq-content" class="auth-tab-content">
                        <div class="qr-container">
                            <div class="qr-header">
                                <i class="fab fa-qq" style="font-size: 2rem; color: #12B7F5;"></i>
                                <h3 data-i18n="scan_qq_qr">Scan with QQ</h3>
                                <p data-i18n="qq_qr_desc">Open QQ and scan the QR code to register</p>
                            </div>
                            <div class="qr-code-wrapper">
                                <div id="qq-qr-code" class="qr-code">
                                    <div class="qr-loading">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p data-i18n="loading_qr">Loading QR Code...</p>
                                    </div>
                                </div>
                                <div id="qq-qr-status" class="qr-status"></div>
                            </div>
                            <button class="glass-button" style="width:100%; margin-top: 1rem;" onclick="refreshQQQR()">
                                <i class="fas fa-sync-alt me-2"></i><span data-i18n="refresh_qr">Refresh QR Code</span>
                            </button>
                        </div>
                    </div>

                    <p class="auth-link"><span data-i18n="already_have_account">Already have an account?</span> <a href="#" onclick="showPage('login')" data-i18n="login">Login</a></p>
                </div>
            </div>

            <!-- Researcher Dashboard -->
            <div id="page-researcher-dashboard" class="page">
                <div class="glass-container">
                    <div class="dashboard-header">
                        <h2 data-i18n="researcher_dashboard"><i class="fas fa-tachometer-alt me-2"></i>Researcher Dashboard</h2>
                        <button class="glass-button" onclick="showCreateExperiment()" data-i18n="create_new_experiment"><i class="fas fa-plus me-2"></i>Create New Experiment</button>
                    </div>
                    <div id="researcher-experiments-container"></div>
                </div>
            </div>

            <!-- Subject Dashboard -->
            <div id="page-subject-dashboard" class="page">
                <div class="glass-container">
                    <h2 data-i18n="available_experiments"><i class="fas fa-flask me-2"></i>Available Experiments</h2>
                    <div class="tabs">
                        <button class="tab-button active" onclick="showSubjectTab('available', event)"><i class="fas fa-list me-1"></i><span data-i18n="available_studies">Available Studies</span></button>
                        <button class="tab-button" onclick="showSubjectTab('registered', event)"><i class="fas fa-check-circle me-1"></i><span data-i18n="my_registrations">My Registrations</span></button>
                    </div>
                    <div id="subject-available-container" class="tab-content active"></div>
                    <div id="subject-registered-container" class="tab-content"></div>
                </div>
            </div>

            <!-- Create/Edit Experiment Modal -->
            <div id="experiment-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeExperimentModal()">&times;</span>
                    <h2 id="experiment-modal-title" data-i18n="create_experiment">Create Experiment</h2>
                    <form id="experiment-form" onsubmit="handleExperimentSubmit(event)">
                        <div class="form-group">
                            <label for="exp-title" data-i18n="title">Title</label>
                            <input type="text" id="exp-title" required>
                        </div>
                        <div class="form-group">
                            <label for="exp-description" data-i18n="description">Description</label>
                            <textarea id="exp-description" rows="4" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="exp-location" data-i18n="location">Location</label>
                                <input type="text" id="exp-location" required>
                            </div>
                            <div class="form-group">
                                <label for="exp-duration" data-i18n="duration_minutes">Duration (minutes)</label>
                                <input type="number" id="exp-duration" min="1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="exp-compensation" data-i18n="compensation">Compensation</label>
                                <input type="text" id="exp-compensation" required>
                            </div>
                            <div class="form-group">
                                <label for="exp-maxParticipants" data-i18n="max_participants_per_session">Max Participants per Session</label>
                                <input type="number" id="exp-maxParticipants" min="1" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="suggested_requirements">Suggested Requirements</label>
                            <div id="suggested-requirements" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                                <span class="requirement-option" data-req-key="req_age_18_plus" data-i18n="req_age_18_plus">Age 18 or older</span>
                                <span class="requirement-option" data-req-key="req_normal_vision" data-i18n="req_normal_vision">Normal or corrected-to-normal vision</span>
                                <span class="requirement-option" data-req-key="req_native_speaker" data-i18n="req_native_speaker">Native language speaker</span>
                                <span class="requirement-option" data-req-key="req_no_neurological" data-i18n="req_no_neurological">No neurological disorders</span>
                                <span class="requirement-option" data-req-key="req_no_psychiatric" data-i18n="req_no_psychiatric">No psychiatric conditions</span>
                                <span class="requirement-option" data-req-key="req_right_handed" data-i18n="req_right_handed">Right-handed</span>
                                <span class="requirement-option" data-req-key="req_no_medication" data-i18n="req_no_medication">Not taking psychoactive medication</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="exp-custom-requirement" data-i18n="custom_requirements">Custom Requirements</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="exp-custom-requirement" class="glass-input" style="flex: 1;">
                                <button type="button" class="glass-button" onclick="addCustomRequirement()" style="padding: 12px 18px;"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label data-i18n="selected_requirements">Selected Requirements</label>
                            <div id="selected-requirements" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; min-height: 40px; padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.15);"></div>
                        </div>
                        <div class="form-group">
                            <label for="exp-status" data-i18n="status">Status</label>
                            <select id="exp-status">
                                <option value="draft" data-i18n="draft">Draft</option>
                                <option value="open" data-i18n="open_for_recruitment">Open for Recruitment</option>
                                <option value="in_progress" data-i18n="in_progress">In Progress</option>
                                <option value="completed" data-i18n="completed">Completed</option>
                            </select>
                        </div>
                        <div id="experiment-error" class="error-message"></div>
                        <div class="modal-buttons">
                            <button type="button" class="glass-button" onclick="closeExperimentModal()" data-i18n="cancel"><i class="fas fa-times me-2"></i>Cancel</button>
                            <button type="submit" id="experiment-submit-btn" class="glass-button" data-i18n="save"><i class="fas fa-save me-2"></i>Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Session Modal -->
            <div id="session-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeSessionModal()">&times;</span>
                    <h2 id="session-modal-title" data-i18n="add_session">Add Session</h2>
                    <form id="session-form" onsubmit="handleSessionSubmit(event)">
                        <div class="form-group">
                            <label for="session-startTime" data-i18n="start_time">Start Time</label>
                            <input type="datetime-local" id="session-startTime" required>
                        </div>
                        <div class="form-group">
                            <label for="session-endTime" data-i18n="end_time">End Time</label>
                            <input type="datetime-local" id="session-endTime" required>
                        </div>
                        <div class="form-group">
                            <label for="session-location" data-i18n="location">Location</label>
                            <input type="text" id="session-location" required>
                        </div>
                        <div class="form-group">
                            <label for="session-maxParticipants" data-i18n="max_participants">Max Participants</label>
                            <input type="number" id="session-maxParticipants" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="session-notes" data-i18n="notes_optional">Notes (optional)</label>
                            <textarea id="session-notes" rows="3"></textarea>
                        </div>
                        <div id="session-error" class="error-message"></div>
                        <div class="modal-buttons">
                            <button type="button" class="glass-button" onclick="closeSessionModal()" data-i18n="cancel"><i class="fas fa-times me-2"></i>Cancel</button>
                            <button type="submit" class="glass-button" data-i18n="save"><i class="fas fa-save me-2"></i>Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>

        <!-- Notification -->
        <div id="notification" class="notification">
            <div class="d-flex align-items-center">
                <i class="fas fa-check-circle me-2"></i>
                <span id="notificationText">Operation completed successfully!</span>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button id="floating-button" class="floating-button" style="display:none;" onclick="showCreateExperiment()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
